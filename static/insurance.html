<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="æ™ºèƒ½é‡‘èåŠ©æ‰‹ - åŸºäºç°ä»£æŠ•èµ„ç»„åˆç†è®º(MPT)çš„AIæŠ•èµ„é¡¾é—®ï¼Œä¸ºæ‚¨æä¾›ä¸ªæ€§åŒ–çš„æŠ•èµ„ç»„åˆæ¨è" />
    <meta name="keywords" content="æŠ•èµ„ç»„åˆ, MPT, ç°ä»£æŠ•èµ„ç»„åˆç†è®º, AI, æ™ºèƒ½é‡‘è, æŠ•èµ„é¡¾é—®, èµ„äº§é…ç½®" />
    <meta name="author" content="æ™ºèƒ½é‡‘èåŠ©æ‰‹" />
    <title>æ™ºèƒ½é‡‘èåŠ©æ‰‹ - AIé©±åŠ¨çš„ä¸ªæ€§åŒ–æŠ•èµ„é¡¾é—®</title>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSSå˜é‡å®šä¹‰ - ç»“åˆä¸¤ä¸ªé¡µé¢çš„é£æ ¼ */
        :root {
            /* è‰²å½©ç³»ç»Ÿ - åŸºäºinsurance.htmlçš„é…è‰² */
            --primary-bg-color: #f8faf9; /* ä¸»èƒŒæ™¯è‰² */
            --card-bg-color: #FFFFFF; /* å¡ç‰‡èƒŒæ™¯è‰² */
            --primary-green: #10B981; /* ä¸»è‰²è°ƒ - æŸ”å’Œçš„ç»¿è‰² */
            --accent-teal: #059669; /* å¼ºè°ƒè‰² - æ·±ç»¿è‰² */
            --danger-red: #EF4444; /* è´Ÿé¢ä¿¡æ¯è‰² - çº¢è‰² */
            --warning-orange: #F59E0B; /* è­¦å‘Šè‰² */
            --text-primary: #1F2937; /* ä¸»è¦æ–‡å­—é¢œè‰² */
            --text-secondary: #6B7280; /* æ¬¡è¦æ–‡å­—é¢œè‰² */
            --border-color: #E5E7EB; /* è¾¹æ¡†é¢œè‰² */

            /* è®¾è®¡å…ƒç´  */
            --border-radius: 12px; /* å¡ç‰‡åœ†è§’ */
            --card-shadow: 0 4px 20px rgba(45, 90, 39, 0.1); /* å¡ç‰‡é˜´å½± */
            --card-hover-shadow: 0 8px 25px rgba(45, 90, 39, 0.15); /* å¡ç‰‡æ‚¬åœé˜´å½± */

            /* å­—ä½“ç³»ç»Ÿ */
            --font-family: 'Noto Sans SC', sans-serif;
            --font-size-xs: 0.75rem;    /* 12px */
            --font-size-sm: 0.875rem;   /* 14px */
            --font-size-base: 1rem;     /* 16px */
            --font-size-lg: 1.125rem;   /* 18px */
            --font-size-xl: 1.25rem;    /* 20px */
            --font-size-2xl: 1.5rem;    /* 24px */
            --font-size-3xl: 1.875rem;  /* 30px */

            /* é—´è·ç³»ç»Ÿ */
            --spacing-xs: 0.25rem;   /* 4px */
            --spacing-sm: 0.5rem;    /* 8px */
            --spacing-md: 1rem;      /* 16px */
            --spacing-lg: 1.5rem;    /* 24px */
            --spacing-xl: 2rem;      /* 32px */
            --spacing-2xl: 3rem;     /* 48px */

            /* è¿‡æ¸¡åŠ¨ç”» */
            --transition-fast: 0.1s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* å…¨å±€é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(135deg, #f8faf9 0%, #e8f5e8 100%);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é€šç”¨å¡ç‰‡æ ·å¼ */
        .card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-color);
        }

        .card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-2px);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            min-height: 44px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-green);
            color: white;
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--accent-teal);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background-color: var(--accent-teal);
            color: white;
            box-shadow: 0 2px 4px rgba(5, 150, 105, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #047857;
            transform: translateY(-1px);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
        }

        .btn-outline:hover:not(:disabled) {
            background-color: var(--primary-green);
            color: white;
        }

        /* å›ºå®šé¡¶éƒ¨æ ‡é¢˜æ  */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg-color);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            padding: var(--spacing-lg) 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-title {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--primary-green);
            margin: 0;
        }

        .app-subtitle {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin: var(--spacing-xs) 0 0 0;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .status-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: 500;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 20px;
            background-color: var(--primary-bg-color);
            border: 1px solid var(--border-color);
        }

        .status-badge.ready .status-dot {
            background-color: var(--primary-green);
        }

        .status-badge.processing .status-dot {
            background-color: var(--accent-teal);
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-secondary);
        }

        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.3; }
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .app-main {
            flex: 1;
            padding-top: 120px;
            padding-bottom: 120px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding-left: var(--spacing-lg);
            padding-right: var(--spacing-lg);
        }

        /* å¢å¼ºçš„å¡ç‰‡æ ·å¼ */
        .questionnaire-card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .questionnaire-card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-1px);
        }

        .card-inner {
            padding: var(--spacing-xl);
        }

        /* ä¸¥æ ¼éµå¾ªå¡ç‰‡è®¾è®¡çš„è¡¨å•å…ƒç´  */
        .form-section {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .form-section-header {
            background-color: rgba(16, 185, 129, 0.05);
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--primary-green);
            margin: 0;
        }

        .form-section-body {
            padding: var(--spacing-lg);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: var(--font-size-base);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .form-label .required {
            color: var(--danger-red);
            margin-left: 2px;
        }

        /* è¾“å…¥æ¡†å¡ç‰‡æ ·å¼ */
        .input-card {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            font-family: var(--font-family);
            background-color: var(--card-bg-color);
            transition: all var(--transition-fast);
            min-height: 52px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .input-card:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
            background-color: #FAFBF9;
        }

        .input-card::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        /* é€‰æ‹©æ¡†å¡ç‰‡æ ·å¼ */
        .select-card {
            position: relative;
            width: 100%;
        }

        .select-control {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            font-family: var(--font-family);
            background-color: var(--card-bg-color);
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 52px;
            appearance: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3E%3Cpath fill='%2310B981' d='M8 12L3 7h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right var(--spacing-md) center;
            padding-right: calc(var(--spacing-md) + 24px);
        }

        .select-control:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
            background-color: #FAFBF9;
        }

        /* å•é€‰æŒ‰é’®å¡ç‰‡æ ·å¼ */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .radio-option {
            background-color: var(--card-bg-color);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
            position: relative;
        }

        .radio-option:hover {
            border-color: var(--accent-teal);
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.15);
            transform: translateY(-1px);
        }

        .radio-option.selected {
            border-color: var(--primary-green);
            background-color: rgba(16, 185, 129, 0.05);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .radio-label {
            font-size: var(--font-size-base);
            color: var(--text-primary);
            line-height: 1.5;
            margin: 0;
            cursor: pointer;
            user-select: none;
        }

        .radio-label strong {
            color: var(--primary-green);
            font-weight: 600;
        }

        /* å›ºå®šåº•éƒ¨æ“ä½œåŒºåŸŸ */
        .fixed-bottom-actions {
            position: fixed;
            bottom: 4rem; /* åœ¨å¯¼èˆªæ ä¸Šæ–¹ */
            left: 0;
            right: 0;
            background-color: white;
            border-top: 1px solid #E5E7EB;
            z-index: 40;
            padding: 1rem;
            text-align: center;
        }

        .submit-button {
            background-color: #10B981;
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 1rem 3rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            min-height: 3.5rem;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
            min-width: 280px;
            width: 100%;
            max-width: 400px;
        }

        .submit-button:hover:not(:disabled) {
            background-color: #059669;
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.35);
            transform: translateY(-2px);
        }

        .submit-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.15);
        }

        /* æäº¤æŒ‰é’®åŠ è½½çŠ¶æ€ */
        .button-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-right: var(--spacing-sm);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* é”™è¯¯æç¤ºå¡ç‰‡ */
        .error-message-card {
            background-color: #fef2f2;
            border: 2px solid var(--danger-red);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-lg);
            overflow: hidden;
        }

        .error-content {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            color: var(--danger-red);
            font-weight: 500;
        }

        .error-icon {
            font-size: var(--font-size-lg);
        }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            padding: var(--spacing-2xl);
        }

        .loading-card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            padding: var(--spacing-2xl);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-2xl);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: var(--spacing-md);
            font-size: var(--font-size-base);
            color: var(--text-secondary);
        }

        .loading-text h3 {
            color: var(--primary-green);
            margin-bottom: var(--spacing-sm);
        }

        .loading-text p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        .loading-steps {
            text-align: left;
            max-width: 300px;
            margin: 0 auto;
        }

        .step {
            padding: var(--spacing-sm) 0;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            transition: color var(--transition-fast);
        }

        .step.completed {
            color: var(--primary-green);
            font-weight: 500;
        }

        /* é”™è¯¯çŠ¶æ€æ ·å¼ */
        .error-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .error-content {
            padding: var(--spacing-xl);
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }

        .error-title {
            color: var(--danger-red);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-2xl);
        }

        .error-message {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xl);
            line-height: 1.6;
        }

        .error-actions {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
        }

        /* ç»“æœé¡µé¢æ ·å¼ */
        .portfolio-result {
            max-width: 1200px;
            margin: 0 auto;
        }

        .result-title {
            font-size: var(--font-size-3xl);
            color: var(--primary-green);
            margin-bottom: var(--spacing-lg);
            text-align: center;
            font-weight: 600;
        }

        .user-profile-summary {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            margin-top: var(--spacing-lg);
        }

        .risk-badge {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .risk-conservative {
            background-color: #d4edda;
            color: #155724;
        }

        .risk-moderate {
            background-color: #fff3cd;
            color: #856404;
        }

        .risk-aggressive {
            background-color: #f8d7da;
            color: #721c24;
        }

        .profile-item {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        .section-subtitle {
            font-size: var(--font-size-base);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            margin: var(--spacing-xl) 0;
        }

        .plan-summary {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-lg);
        }

        .summary-item {
            color: var(--text-primary);
            font-weight: 500;
        }

        .summary-amount {
            color: var(--primary-green);
            font-weight: 600;
            font-size: var(--font-size-xl);
        }

        .plan-table-container {
            overflow-x: auto;
            margin-top: var(--spacing-lg);
        }

        .plan-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .plan-table th,
        .plan-table td {
            padding: var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .plan-table th {
            background-color: rgba(16, 185, 129, 0.05);
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }

        .plan-table tr:last-child td {
            border-bottom: none;
        }

        .fund-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .fund-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .fund-rank {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background-color: var(--primary-green);
            color: white;
            border-radius: 50%;
            font-size: var(--font-size-xs);
            font-weight: 600;
        }

        .weight-display {
            min-width: 150px;
        }

        .weight-bar {
            position: relative;
            height: 20px;
            background-color: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .weight-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-teal));
            transition: width 1s ease-in-out;
        }

        .weight-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--text-primary);
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }

        .amount-cell {
            font-weight: 500;
        }

        .amount-text {
            color: var(--primary-green);
            font-weight: 600;
        }

        .risk-level-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--font-size-xs);
            font-weight: 500;
        }

        .risk-low {
            background-color: #d4edda;
            color: #155724;
        }

        .risk-medium {
            background-color: #fff3cd;
            color: #856404;
        }

        .risk-high {
            background-color: #f8d7da;
            color: #721c24;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .metric-card {
            background-color: var(--card-bg-color);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
            transition: all var(--transition-fast);
        }

        .metric-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            transform: translateY(-1px);
        }

        .metric-card.positive {
            border-left: 4px solid var(--primary-green);
        }

        .metric-card.warning {
            border-left: 4px solid var(--warning-orange);
        }

        .metric-card.danger {
            border-left: 4px solid var(--danger-red);
        }

        .metric-icon {
            font-size: 2rem;
            min-width: 60px;
            text-align: center;
        }

        .metric-content {
            flex: 1;
        }

        .metric-title {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        .metric-value {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .positive-value {
            color: var(--primary-green);
        }

        .danger-value {
            color: var(--danger-red);
        }

        .metric-description {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .explanation-content {
            margin-top: var(--spacing-lg);
            max-height: 600px;
            overflow-y: auto;
            padding-right: var(--spacing-sm);
        }

        .explanation-text {
            line-height: 1.8;
            font-size: var(--font-size-base);
            color: var(--text-primary);
        }

        .disclaimer-card {
            background-color: #fef2f2;
            border: 2px solid var(--danger-red);
            border-radius: var(--border-radius);
            margin: var(--spacing-xl) 0;
            overflow: hidden;
        }

        .disclaimer-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
            padding: var(--spacing-xl);
        }

        .disclaimer-icon {
            font-size: var(--font-size-2xl);
            color: var(--danger-red);
            margin-top: var(--spacing-xs);
        }

        .disclaimer-title {
            color: var(--danger-red);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-xl);
            font-weight: 600;
        }

        .disclaimer-text {
            color: var(--danger-red);
            line-height: 1.6;
            font-size: var(--font-size-sm);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        /* äº§å“å±•ç¤ºåŒºåŸŸæ ·å¼ - æ¥è‡ªinsurance.html */
        .products-container {
            margin-top: var(--spacing-xl);
        }

        .product-categories {
            display: flex;
            gap: var(--spacing-sm);
            overflow-x: auto;
            padding-bottom: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .category-tab {
            flex-shrink: 0;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: 500;
            transition: all var(--transition-fast);
            background-color: var(--border-color);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
        }

        .category-tab.active {
            background-color: var(--primary-green);
            color: white;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .product-card {
            background-color: var(--card-bg-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--card-shadow);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-color);
            cursor: pointer;
        }

        .product-card:hover {
            box-shadow: var(--card-hover-shadow);
            transform: translateY(-2px);
        }

        .product-card.risk-low {
            border-left: 4px solid var(--primary-green);
        }

        .product-card.risk-medium {
            border-left: 4px solid var(--warning-orange);
        }

        .product-card.risk-high {
            border-left: 4px solid var(--danger-red);
        }

        .product-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .product-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
        }

        .product-risk {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .risk-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .risk-dot.low {
            background-color: var(--primary-green);
        }

        .risk-dot.medium {
            background-color: var(--warning-orange);
        }

        .risk-dot.high {
            background-color: var(--danger-red);
        }

        .product-name {
            font-weight: 600;
            font-size: var(--font-size-base);
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .product-type {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .product-description {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: var(--spacing-md);
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .product-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .product-tag {
            padding: 2px 8px;
            background-color: #dbeafe;
            color: #1e40af;
            border-radius: 12px;
            font-size: var(--font-size-xs);
        }

        /* æœç´¢æ æ ·å¼ */
        .search-container {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-base);
            background-color: var(--card-bg-color);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.15);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--spacing-sm);
                text-align: center;
            }

            .app-title {
                font-size: var(--font-size-xl);
            }

            .error-actions {
                flex-direction: column;
            }

            .error-actions .btn {
                width: 100%;
            }

            .portfolio-result {
                padding: var(--spacing-md);
            }

            .result-title {
                font-size: var(--font-size-2xl);
            }

            .user-profile-summary {
                flex-direction: column;
                gap: var(--spacing-sm);
            }

            .plan-summary {
                flex-direction: column;
                gap: var(--spacing-xs);
                text-align: center;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }

            .plan-table {
                font-size: var(--font-size-sm);
            }

            .chart-container {
                height: 300px;
            }

            .questionnaire-form {
                padding: var(--spacing-md);
            }

            .form-intro-title {
                font-size: var(--font-size-xl);
            }

            .question-title {
                font-size: var(--font-size-base);
            }

            .submit-button {
                width: 100%;
                min-width: auto;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .product-categories {
                flex-wrap: wrap;
            }
        }

        /* éšè—ç±» */
        .hidden {
            display: none !important;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--primary-bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* è§¦æ‘¸åé¦ˆ */
        .touch-feedback {
            transition: transform 0.1s ease;
        }

        .touch-feedback:active {
            transform: scale(0.98);
        }

        /* è°ƒæ•´ä¸»å†…å®¹åŒºåŸŸåº•éƒ¨é—´è·ï¼Œä¸ºå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        .app-main {
            padding-bottom: 160px; /* å¢åŠ è¿™ä¸ªå€¼ä»¥é€‚åº”å¯¼èˆªæ é«˜åº¦ */
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å›ºå®šé¡¶éƒ¨æ ‡é¢˜æ  -->
        <header class="app-header">
            <div class="header-content">
                <div>
                    <h1 class="app-title">æ™ºèƒ½é‡‘èåŠ©æ‰‹</h1>
                    <p class="app-subtitle">åŸºäºç°ä»£æŠ•èµ„ç»„åˆç†è®º(MPT)çš„AIæŠ•èµ„é¡¾é—®</p>
                </div>
                <div class="header-status">
                    <div id="statusBadge" class="status-badge ready">
                        <span class="status-dot"></span>
                        ç³»ç»Ÿå°±ç»ª
                    </div>
                </div>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="app-main">
            <!-- é—®å·è¡¨å•é¡µé¢ -->
            <div id="questionnaireView">
                <div class="questionnaire-form">
                    <!-- é—®å·è¯´æ˜å¡ç‰‡ -->
                    <div class="questionnaire-card">
                        <div class="card-inner">
                            <h2 class="form-intro-title">æŠ•èµ„éœ€æ±‚è¯„ä¼°é—®å·</h2>
                            <p class="form-intro-subtitle">
                                è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨å®šåˆ¶ä¸“å±çš„æŠ•èµ„ç»„åˆæ–¹æ¡ˆ
                            </p>
                        </div>
                    </div>

                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="section-title">åŸºæœ¬ä¿¡æ¯</h3>
                        </div>
                        <div class="form-section-body">
                            <!-- å¹´é¾„ -->
                            <div class="form-group">
                                <label class="form-label">
                                    æ‚¨çš„å¹´é¾„ <span class="required">*</span>
                                </label>
                                <input
                                    id="age"
                                    type="text"
                                    class="input-card"
                                    placeholder="è¯·è¾“å…¥æ‚¨çš„å¹´é¾„"
                                    required
                                />
                            </div>

                            <!-- å¹´åº¦å¯æŠ•èµ„é‡‘é¢ -->
                            <div class="form-group">
                                <label class="form-label">
                                    å¹´åº¦å¯æŠ•èµ„é‡‘é¢ï¼ˆå…ƒï¼‰<span class="required">*</span>
                                </label>
                                <input
                                    id="annualInvestmentAmount"
                                    type="text"
                                    class="input-card"
                                    placeholder="è¯·è¾“å…¥å¹´åº¦æŠ•èµ„é‡‘é¢"
                                    required
                                />
                            </div>
                        </div>
                    </div>

                    <!-- æŠ•èµ„åå¥½ -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="section-title">æŠ•èµ„åå¥½</h3>
                        </div>
                        <div class="form-section-body">
                            <!-- æµåŠ¨æ€§éœ€æ±‚ -->
                            <div class="form-group">
                                <label class="form-label">
                                    æµåŠ¨æ€§éœ€æ±‚ <span class="required">*</span>
                                </label>
                                <div class="select-card">
                                    <select id="liquidityDemand" class="select-control" required>
                                        <option value="">è¯·é€‰æ‹©æ‚¨çš„æµåŠ¨æ€§éœ€æ±‚</option>
                                        <option value="éšæ—¶å¯èƒ½å–å‡º">éšæ—¶å¯èƒ½å–å‡º</option>
                                        <option value="åŠå¹´å†…å¯èƒ½å–å‡º">åŠå¹´å†…å¯èƒ½å–å‡º</option>
                                        <option value="1-3å¹´å†…ä¸ä¼šå–å‡º">1-3å¹´å†…ä¸ä¼šå–å‡º</option>
                                        <option value="3-5å¹´å†…ä¸ä¼šå–å‡º">3-5å¹´å†…ä¸ä¼šå–å‡º</option>
                                        <option value="5å¹´ä»¥ä¸Šä¸ä¼šå–å‡º">5å¹´ä»¥ä¸Šä¸ä¼šå–å‡º</option>
                                    </select>
                                </div>
                            </div>

                            <!-- æŠ•èµ„ç›®æ ‡ -->
                            <div class="form-group">
                                <label class="form-label">
                                    æŠ•èµ„ç›®æ ‡ <span class="required">*</span>
                                </label>
                                <div class="select-card">
                                    <select id="targetReturnDescription" class="select-control" required>
                                        <option value="">è¯·é€‰æ‹©æ‚¨çš„æŠ•èµ„ç›®æ ‡</option>
                                        <option value="ä¿æœ¬ä¸ºä¸»">ä¿æœ¬ä¸ºä¸»</option>
                                        <option value="è·‘èµ¢é€šèƒ€">è·‘èµ¢é€šèƒ€</option>
                                        <option value="ç¨³å¥å¢é•¿">ç¨³å¥å¢é•¿</option>
                                        <option value="è¾ƒé«˜å¢é•¿">è¾ƒé«˜å¢é•¿</option>
                                        <option value="é«˜å¢é•¿">é«˜å¢é•¿</option>
                                    </select>
                                </div>
                            </div>

                            <!-- æŠ•èµ„æœŸé™ -->
                            <div class="form-group">
                                <label class="form-label">
                                    æŠ•èµ„æœŸé™ <span class="required">*</span>
                                </label>
                                <div class="select-card">
                                    <select id="investmentHorizon" class="select-control" required>
                                        <option value="">è¯·é€‰æ‹©æ‚¨çš„æŠ•èµ„æœŸé™</option>
                                        <option value="1å¹´ä»¥å†…">1å¹´ä»¥å†…</option>
                                        <option value="1-3å¹´">1-3å¹´</option>
                                        <option value="3-5å¹´">3-5å¹´</option>
                                        <option value="5-10å¹´">5-10å¹´</option>
                                        <option value="10å¹´ä»¥ä¸Š">10å¹´ä»¥ä¸Š</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é£é™©è¯„ä¼° -->
                    <div class="form-section">
                        <div class="form-section-header">
                            <h3 class="section-title">é£é™©è¯„ä¼°</h3>
                        </div>
                        <div class="form-section-body">
                            <!-- é£é™©åœºæ™¯é€‰æ‹© -->
                            <div class="form-group">
                                <label class="form-label question-title">
                                    å‡è®¾æ‚¨æŠ•èµ„äº†10ä¸‡å…ƒï¼Œä¸€ä¸ªæœˆåäºæŸäº†1ä¸‡å…ƒï¼Œæ‚¨ä¼šæ€ä¹ˆåšï¼Ÿ
                                    <span class="required">*</span>
                                </label>
                                <div class="radio-group" id="riskScenarioGroup">
                                    <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- é£é™©å…³æ³¨ç‚¹ -->
                            <div class="form-group">
                                <label class="form-label question-title">
                                    å¯¹äºæŠ•èµ„ï¼Œæ‚¨æ›´çœ‹é‡çš„æ˜¯ï¼Ÿ <span class="required">*</span>
                                </label>
                                <div class="radio-group" id="riskFocusGroup">
                                    <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>

                            <!-- æŠ•èµ„çŸ¥è¯†æ°´å¹³ -->
                            <div class="form-group">
                                <label class="form-label question-title">
                                    æ‚¨å¦‚ä½•æè¿°è‡ªå·±çš„æŠ•èµ„çŸ¥è¯†æ°´å¹³ï¼Ÿ <span class="required">*</span>
                                </label>
                                <div class="radio-group" id="knowledgeGroup">
                                    <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é”™è¯¯æç¤º -->
                    <div id="errorMessageCard" class="error-message-card hidden">
                        <div class="error-content">
                            <span class="error-icon">âš ï¸</span>
                            <span id="errorMessageText"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingView" class="loading-container hidden">
                <div class="loading-card">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">
                            <h3>æ­£åœ¨ç”Ÿæˆæ‚¨çš„ä¸“å±æŠ•èµ„æ–¹æ¡ˆ</h3>
                            <p>åŸºäºç°ä»£æŠ•èµ„ç»„åˆç†è®º(MPT)è¿›è¡Œæ™ºèƒ½åˆ†æ...</p>
                            <div class="loading-steps">
                                <div id="step1" class="step">âœ“ åˆ†æç”¨æˆ·é£é™©åå¥½</div>
                                <div id="step2" class="step">âœ“ è®¡ç®—æœ‰æ•ˆè¾¹ç•Œ</div>
                                <div id="step3" class="step">âœ“ ä¼˜åŒ–æŠ•èµ„ç»„åˆ</div>
                                <div id="step4" class="step">
                                    <span>â³</span>
                                    ç”ŸæˆAIä¸“ä¸šè§£é‡Š
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤ºé¡µé¢ -->
            <div id="resultView" class="portfolio-result hidden">
                <!-- ç»“æœå†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- äº§å“å±•ç¤ºé¡µé¢ -->
            <div id="productsView" class="products-container hidden">
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h2 class="section-title">æ¨èç†è´¢äº§å“</h2>
                        <p class="section-subtitle">åŸºäºæ‚¨çš„é£é™©åå¥½ä¸ºæ‚¨ç²¾é€‰çš„ç†è´¢äº§å“</p>
                        
                        <!-- äº§å“åˆ†ç±» -->
                        <div class="product-categories">
                            <button class="category-tab active" data-category="all">å…¨éƒ¨</button>
                            <button class="category-tab" data-category="fund">åŸºé‡‘</button>
                            <button class="category-tab" data-category="insurance">ä¿é™©</button>
                            <button class="category-tab" data-category="deposit">å­˜æ¬¾</button>
                            <button class="category-tab" data-category="bond">å€ºåˆ¸</button>
                            <button class="category-tab" data-category="stock">è‚¡ç¥¨</button>
                        </div>
                        
                        <!-- æœç´¢æ  -->
                        <div class="search-container flex items-center gap-3">
                            <div class="flex-1 relative">
                                <div class="search-icon">ğŸ”</div>
                                <input type="text" id="productSearch" class="search-input" placeholder="æœç´¢ç†è´¢äº§å“...">
                            </div>
                            <button id="backToResults" class="btn btn-outline">
                                â† è¿”å›æ¨èç»“æœ
                            </button>
                        </div>
                        
                        <!-- äº§å“åˆ—è¡¨ -->
                        <div id="productsList" class="products-grid">
                            <!-- äº§å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- é”™è¯¯é¡µé¢ -->
            <div id="errorView" class="error-container hidden">
                <div class="card">
                    <div class="error-content">
                        <div class="error-icon">âŒ</div>
                        <h2 class="error-title">å‡ºé”™äº†</h2>
                        <p id="errorViewMessage" class="error-message"></p>
                        <div class="error-actions">
                            <button id="retryButton" class="btn btn-primary">é‡è¯•</button>
                            <button id="resetButton" class="btn btn-outline">é‡æ–°å¼€å§‹</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

         <!-- å›ºå®šåº•éƒ¨æäº¤æŒ‰é’® -->
        <div id="submitActions" class="fixed-bottom-actions">
            <button
                id="submitButton"
                type="button"
                class="submit-button"
                disabled
            >
                ç”Ÿæˆä¸“å±æŠ•èµ„æ–¹æ¡ˆ
            </button>
        </div>

        <!-- åº•éƒ¨å¯¼èˆªæ  -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40">
            <div class="grid grid-cols-5 h-16">
                <a href="index.html" class="flex flex-col items-center justify-center text-gray-600">
                    <span class="text-lg mb-1">ğŸ </span>
                    <span class="text-xs">é¦–é¡µ</span>
                </a>
                <a href="bills.html" class="flex flex-col items-center justify-center text-gray-400">
                    <span class="text-lg mb-1">ğŸ“</span>
                    <span class="text-xs">è´¦å•</span>
                </a>
                <a href="analysis.html" class="flex flex-col items-center justify-center text-gray-400">
                    <span class="text-lg mb-1">ğŸ“Š</span>
                    <span class="text-xs">åˆ†æ</span>
                </a>
                <a href="savings.html" class="flex flex-col items-center justify-center text-gray-400">
                    <span class="text-lg mb-1">ğŸ¯</span>
                    <span class="text-xs">å‚¨è“„</span>
                </a>
                <a href="insurance.html" class="flex flex-col items-center justify-center text-green-400">
                    <span class="text-lg mb-1">ğŸ“ˆ</span>
                    <span class="text-xs">æŠ•èµ„</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const AppState = {
            currentView: 'questionnaire',
            isLoading: false,
            resultData: null,
            errorMessage: '',
            loadingStep: 0
        };

        // é€‰é¡¹æ•°æ®
        const riskScenarioOptions = [
            {
                value: 'a) å–å‡ºæ­¢æŸ',
                label: '<strong>a) å–å‡ºæ­¢æŸ</strong> - æ— æ³•æ‰¿å—æœ¬é‡‘æŸå¤±ï¼Œç«‹å³æ­¢æŸ'
            },
            {
                value: 'b) ç»§ç»­æŒæœ‰',
                label: '<strong>b) ç»§ç»­æŒæœ‰</strong> - ç›¸ä¿¡é•¿æœŸæŠ•èµ„ï¼Œç­‰å¾…åå¼¹'
            },
            {
                value: 'c) åŠ ä»“ä¹°å…¥',
                label: '<strong>c) åŠ ä»“ä¹°å…¥</strong> - è®¤ä¸ºæ˜¯ä¹°å…¥æœºä¼šï¼Œå¢åŠ æŠ•èµ„'
            }
        ];

        const riskFocusOptions = [
            {
                value: 'a) æœ¬é‡‘ç»å¯¹å®‰å…¨',
                label: '<strong>a) æœ¬é‡‘ç»å¯¹å®‰å…¨</strong> - ä¿æœ¬æ˜¯ç¬¬ä¸€ä½ï¼Œæ”¶ç›Šå¯ä»¥é€‚å½“ç‰ºç‰²'
            },
            {
                value: 'b) è·‘èµ¢é€šèƒ€',
                label: '<strong>b) è·‘èµ¢é€šèƒ€</strong> - åœ¨æ§åˆ¶é£é™©çš„å‰æä¸‹è·å–ç¨³å®šæ”¶ç›Š'
            },
            {
                value: 'c) è·å¾—è¿œè¶…å¸‚åœºçš„æ”¶ç›Šï¼Œå“ªæ€•é£é™©å¾ˆé«˜',
                label: '<strong>c) è·å¾—è¿œè¶…å¸‚åœºçš„æ”¶ç›Š</strong> - è¿½æ±‚é«˜æ”¶ç›Šï¼Œæ„¿æ„æ‰¿æ‹…é«˜é£é™©'
            }
        ];

        const knowledgeOptions = [
            {
                value: 'a) å°ç™½',
                label: '<strong>a) å°ç™½</strong> - æŠ•èµ„æ–°æ‰‹ï¼Œå¯¹é‡‘èäº§å“äº†è§£æœ‰é™'
            },
            {
                value: 'b) ç•¥æœ‰äº†è§£',
                label: '<strong>b) ç•¥æœ‰äº†è§£</strong> - æœ‰åŸºæœ¬æŠ•èµ„æ¦‚å¿µï¼Œæœ‰ä¸€äº›æŠ•èµ„ç»éªŒ'
            },
            {
                value: 'c) ç»éªŒä¸°å¯Œ',
                label: '<strong>c) ç»éªŒä¸°å¯Œ</strong> - æ·±å…¥äº†è§£å„ç§æŠ•èµ„äº§å“ï¼Œæœ‰ä¸°å¯Œç»éªŒ'
            }
        ];

        // äº§å“æ•°æ®
        const financialProducts = [
            {
                id: 1,
                name: "ç¨³å¥å¢é•¿æ··åˆåŸºé‡‘",
                type: "fund",
                description: "æŠ•èµ„äºä¼˜è´¨è‚¡ç¥¨å’Œå€ºåˆ¸çš„æ··åˆå‹åŸºé‡‘ï¼Œè¿½æ±‚é•¿æœŸç¨³å¥å¢é•¿",
                riskLevel: "low",
                expectedReturn: 5.8,
                minInvestment: 1000,
                investmentPeriod: "3å¹´",
                tags: ["ç¨³å¥", "æ··åˆ", "é•¿æœŸ"]
            },
            {
                id: 2,
                name: "é«˜æ”¶ç›Šå€ºåˆ¸åŸºé‡‘",
                type: "bond",
                description: "ä¸»è¦æŠ•èµ„äºé«˜ä¿¡ç”¨è¯„çº§ä¼ä¸šå€ºåˆ¸ï¼Œæä¾›ç¨³å®šæ”¶ç›Š",
                riskLevel: "low",
                expectedReturn: 4.2,
                minInvestment: 1000,
                investmentPeriod: "2å¹´",
                tags: ["å€ºåˆ¸", "ç¨³å®š", "æ”¶ç›Š"]
            },
            {
                id: 3,
                name: "ç§‘æŠ€æˆé•¿è‚¡ç¥¨åŸºé‡‘",
                type: "fund",
                description: "ä¸“æ³¨äºç§‘æŠ€åˆ›æ–°é¢†åŸŸçš„è‚¡ç¥¨åŸºé‡‘ï¼Œè¿½æ±‚é«˜æˆé•¿æ€§",
                riskLevel: "high",
                expectedReturn: 12.5,
                minInvestment: 1000,
                investmentPeriod: "5å¹´",
                tags: ["ç§‘æŠ€", "æˆé•¿", "é«˜æ”¶ç›Š"]
            },
            {
                id: 4,
                name: "å®šæœŸå­˜æ¬¾",
                type: "deposit",
                description: "é“¶è¡Œå®šæœŸå­˜æ¬¾äº§å“ï¼Œæœ¬é‡‘å®‰å…¨ï¼Œæ”¶ç›Šç¨³å®š",
                riskLevel: "low",
                expectedReturn: 2.1,
                minInvestment: 50,
                investmentPeriod: "1å¹´",
                tags: ["ä¿æœ¬", "å®‰å…¨", "å®šæœŸ"]
            },
            {
                id: 5,
                name: "äººå¯¿ä¿é™©ç†è´¢è®¡åˆ’",
                type: "insurance",
                description: "ç»“åˆä¿é™©ä¿éšœä¸ç†è´¢åŠŸèƒ½çš„ç»¼åˆæ€§äº§å“",
                riskLevel: "medium",
                expectedReturn: 3.8,
                minInvestment: 5000,
                investmentPeriod: "10å¹´",
                tags: ["ä¿é™©", "ä¿éšœ", "ç†è´¢"]
            },
            {
                id: 6,
                name: "è“ç­¹è‚¡æŠ•èµ„ç»„åˆ",
                type: "stock",
                description: "æŠ•èµ„äºå¤§å‹è“ç­¹å…¬å¸çš„è‚¡ç¥¨ç»„åˆï¼Œé£é™©ç›¸å¯¹å¯æ§",
                riskLevel: "medium",
                expectedReturn: 8.2,
                minInvestment: 5000,
                investmentPeriod: "3å¹´",
                tags: ["è“ç­¹", "è‚¡ç¥¨", "åˆ†æ•£"]
            }
        ];

        // DOMå…ƒç´ å¼•ç”¨
        const elements = {
            // è§†å›¾å®¹å™¨
            questionnaireView: document.getElementById('questionnaireView'),
            loadingView: document.getElementById('loadingView'),
            resultView: document.getElementById('resultView'),
            productsView: document.getElementById('productsView'),
            errorView: document.getElementById('errorView'),
            
            // çŠ¶æ€æŒ‡ç¤ºå™¨
            statusBadge: document.getElementById('statusBadge'),
            
            // è¡¨å•å…ƒç´ 
            age: document.getElementById('age'),
            annualInvestmentAmount: document.getElementById('annualInvestmentAmount'),
            liquidityDemand: document.getElementById('liquidityDemand'),
            targetReturnDescription: document.getElementById('targetReturnDescription'),
            investmentHorizon: document.getElementById('investmentHorizon'),
            riskScenarioGroup: document.getElementById('riskScenarioGroup'),
            riskFocusGroup: document.getElementById('riskFocusGroup'),
            knowledgeGroup: document.getElementById('knowledgeGroup'),
            
            // æŒ‰é’®
            submitButton: document.getElementById('submitButton'),
            retryButton: document.getElementById('retryButton'),
            resetButton: document.getElementById('resetButton'),
            submitActions: document.getElementById('submitActions'),
            
            // é”™è¯¯ä¿¡æ¯
            errorMessageCard: document.getElementById('errorMessageCard'),
            errorMessageText: document.getElementById('errorMessageText'),
            errorViewMessage: document.getElementById('errorViewMessage'),
            
            // åŠ è½½æ­¥éª¤
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            step4: document.getElementById('step4'),
            
            // äº§å“ç›¸å…³
            productsList: document.getElementById('productsList'),
            productSearch: document.getElementById('productSearch')
        };

        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            setupRadioOptions();
            setupEventListeners();
            elements.submitButton.disabled = true;
            setupProductCategories();
            setupProductSearch();
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç»“æœæ•°æ®
            const savedResult = localStorage.getItem('investmentResult');
            if (savedResult && checkResultValidity()) {
                AppState.resultData = JSON.parse(savedResult);
                showView('result');
                renderResultView(AppState.resultData);
            } else {
                // æ¸…é™¤è¿‡æœŸæ•°æ®
                if (savedResult) {
                    localStorage.removeItem('investmentResult');
                    localStorage.removeItem('lastAssessmentTime');
                }
                showView('questionnaire');
            }
        }

        // è®¾ç½®å•é€‰é€‰é¡¹
        function setupRadioOptions() {
            createRadioOptions(elements.riskScenarioGroup, riskScenarioOptions, 'riskScenario');
            createRadioOptions(elements.riskFocusGroup, riskFocusOptions, 'riskFocus');
            createRadioOptions(elements.knowledgeGroup, knowledgeOptions, 'knowledge');
        }

        // åˆ›å»ºå•é€‰é€‰é¡¹
        function createRadioOptions(container, options, name) {
            container.innerHTML = '';
            options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'radio-option';
                optionElement.innerHTML = `
                    <input type="radio" id="${name}_${index}" name="${name}" value="${option.value}" class="hidden-radio">
                    <label for="${name}_${index}" class="radio-label">
                        <span>${option.label}</span>
                    </label>
                `;
                container.appendChild(optionElement);
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                optionElement.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    updateRadioSelection(this);
                    validateForm(); // æ·»åŠ è¿™ä¸€è¡Œ
                });
            });
        }

        // æ›´æ–°å•é€‰é€‰æ‹©çŠ¶æ€
        function updateRadioSelection(selectedElement) {
            // ç§»é™¤åŒç»„å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            const parent = selectedElement.parentElement;
            const siblings = parent.querySelectorAll('.radio-option');
            siblings.forEach(sibling => {
                sibling.classList.remove('selected');
            });
            
            // æ·»åŠ å½“å‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            selectedElement.classList.add('selected');
        }

        // è®¾ç½®äº§å“åˆ†ç±»
        function setupProductCategories() {
            const categoryTabs = document.querySelectorAll('.category-tab');
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    categoryTabs.forEach(t => t.classList.remove('active'));
                    // æ·»åŠ å½“å‰activeç±»
                    this.classList.add('active');
                    
                    const category = this.getAttribute('data-category');
                    filterProducts(category);
                });
            });
        }

        // è®¾ç½®äº§å“æœç´¢
        function setupProductSearch() {
            let searchTimeout;
            elements.productSearch.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const query = this.value.trim();
                    if (query) {
                        searchProducts(query);
                    } else {
                        renderProducts();
                    }
                }, 300);
            });
        }

        // ç­›é€‰äº§å“
        function filterProducts(category) {
            let filteredProducts = financialProducts;
            
            if (category !== 'all') {
                filteredProducts = financialProducts.filter(product => product.type === category);
            }
            
            renderProducts(filteredProducts);
        }

        // æœç´¢äº§å“
        function searchProducts(query) {
            const filteredProducts = financialProducts.filter(product => 
                product.name.toLowerCase().includes(query.toLowerCase()) ||
                product.description.toLowerCase().includes(query.toLowerCase()) ||
                product.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
            );
            
            renderProducts(filteredProducts);
        }

        // æ¸²æŸ“äº§å“åˆ—è¡¨
        function renderProducts(products = financialProducts) {
            elements.productsList.innerHTML = '';
            
            if (products.length === 0) {
                elements.productsList.innerHTML = `
                    <div class="text-center py-8 col-span-full">
                        <div class="text-4xl mb-2">ğŸ”</div>
                        <p class="text-gray-500">æœªæ‰¾åˆ°ç›¸å…³äº§å“</p>
                    </div>
                `;
                return;
            }
            
            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = `product-card risk-${product.riskLevel} touch-feedback`;
                productElement.innerHTML = `
                    <div class="product-header">
                        <div class="product-icon">ğŸ’°</div>
                        <div class="product-risk">
                            <div class="risk-dot ${product.riskLevel}"></div>
                            <span class="text-xs">${getRiskLevelText(product.riskLevel)}</span>
                        </div>
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-type">${getProductTypeText(product.type)}</div>
                    <div class="product-description">${product.description}</div>
                    <div class="product-meta">
                        <span>é¢„æœŸæ”¶ç›Š: ${product.expectedReturn}%</span>
                        <span>èµ·æŠ•: Â¥${product.minInvestment}</span>
                    </div>
                    <div class="product-tags">
                        ${product.tags.map(tag => `<span class="product-tag">${tag}</span>`).join('')}
                    </div>
                `;
                
                elements.productsList.appendChild(productElement);
            });
            
            // æ·»åŠ è¿›å…¥åŠ¨ç”»
            if (window.anime) {
                anime({
                    targets: '.product-card',
                    translateY: [20, 0],
                    opacity: [0, 1],
                    delay: anime.stagger(100),
                    duration: 500,
                    easing: 'easeOutQuart'
                });
            }
        }

        // è·å–é£é™©ç­‰çº§æ–‡æœ¬
        function getRiskLevelText(riskLevel) {
            const riskLevels = {
                'low': 'ä½é£é™©',
                'medium': 'ä¸­ç­‰é£é™©',
                'high': 'é«˜é£é™©'
            };
            return riskLevels[riskLevel] || 'æœªçŸ¥é£é™©';
        }

        // è·å–äº§å“ç±»å‹æ–‡æœ¬
        function getProductTypeText(type) {
            const productTypes = {
                'fund': 'åŸºé‡‘',
                'insurance': 'ä¿é™©',
                'deposit': 'å­˜æ¬¾',
                'bond': 'å€ºåˆ¸',
                'stock': 'è‚¡ç¥¨'
            };
            return productTypes[type] || 'å…¶ä»–';
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æäº¤æŒ‰é’®
            elements.submitButton.addEventListener('click', handleFormSubmit);
            
            // é‡è¯•å’Œé‡ç½®æŒ‰é’®
            elements.retryButton.addEventListener('click', handleRetry);
            elements.resetButton.addEventListener('click', handleReset);
            
            // è¡¨å•è¾“å…¥éªŒè¯
            const formInputs = document.querySelectorAll('input, select');
            formInputs.forEach(input => {
                input.addEventListener('input', validateForm);
                input.addEventListener('change', validateForm);
            });

            // è¿”å›æ¨èç»“æœæŒ‰é’®
            document.getElementById('backToResults').addEventListener('click', () => {
                showView('result');
            });
        }

        // æ˜¾ç¤ºæŒ‡å®šè§†å›¾
        function showView(viewName) {
            // éšè—æ‰€æœ‰è§†å›¾
            elements.questionnaireView.classList.add('hidden');
            elements.loadingView.classList.add('hidden');
            elements.resultView.classList.add('hidden');
            elements.productsView.classList.add('hidden');
            elements.errorView.classList.add('hidden');
            
            // æ˜¾ç¤ºæŒ‡å®šè§†å›¾
            switch (viewName) {
                case 'questionnaire':
                    elements.questionnaireView.classList.remove('hidden');
                    elements.submitActions.classList.remove('hidden');
                    updateStatusBadge('ready');
                    break;
                case 'loading':
                    elements.loadingView.classList.remove('hidden');
                    elements.submitActions.classList.add('hidden');
                    updateStatusBadge('processing');
                    break;
                case 'result':
                    elements.resultView.classList.remove('hidden');
                    elements.submitActions.classList.add('hidden');
                    updateStatusBadge('ready');
                    break;
                case 'products':
                    elements.productsView.classList.remove('hidden');
                    elements.submitActions.classList.add('hidden');
                    updateStatusBadge('ready');
                    renderProducts();
                    break;
                case 'error':
                    elements.errorView.classList.remove('hidden');
                    elements.submitActions.classList.add('hidden');
                    updateStatusBadge('ready');
                    break;
            }
            
            AppState.currentView = viewName;
        }

        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatusBadge(status) {
            elements.statusBadge.className = 'status-badge ' + status;
            elements.statusBadge.innerHTML = `
                <span class="status-dot"></span>
                ${status === 'ready' ? 'ç³»ç»Ÿå°±ç»ª' : 'å¤„ç†ä¸­...'}
            `;
        }

        // è¡¨å•éªŒè¯
        function validateForm() {
            const isValid = isFormValid();
            elements.submitButton.disabled = !isValid;
            return isValid;
        }

        // æ£€æŸ¥è¡¨å•æ˜¯å¦æœ‰æ•ˆ
        function isFormValid() {
            const formData = getFormData();
            const requiredFields = [
                formData.age,
                formData.annual_investment_amount,
                formData.liquidity_demand,
                formData.target_return_description,
                formData.investment_horizon,
                formData.risk_scenario_choice,
                formData.risk_focus_choice,
                formData.investment_knowledge_level
            ];
            
            return requiredFields.every(field => field && field.trim() !== '');
        }

        // è·å–è¡¨å•æ•°æ®
        function getFormData() {
            const riskScenarioSelected = document.querySelector('input[name="riskScenario"]:checked');
            const riskFocusSelected = document.querySelector('input[name="riskFocus"]:checked');
            const knowledgeSelected = document.querySelector('input[name="knowledge"]:checked');
            
            return {
                age: elements.age.value,
                annual_investment_amount: elements.annualInvestmentAmount.value,
                liquidity_demand: elements.liquidityDemand.value,
                target_return_description: elements.targetReturnDescription.value,
                investment_horizon: elements.investmentHorizon.value,
                risk_scenario_choice: riskScenarioSelected ? riskScenarioSelected.value : '',
                risk_focus_choice: riskFocusSelected ? riskFocusSelected.value : '',
                investment_knowledge_level: knowledgeSelected ? knowledgeSelected.value : ''
            };
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            elements.errorMessageText.textContent = message;
            elements.errorMessageCard.classList.remove('hidden');
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            elements.errorMessageCard.classList.add('hidden');
        }

        // å¤„ç†è¡¨å•æäº¤
        async function handleFormSubmit() {
            if (!validateForm()) {
                showError('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }

            const formData = getFormData();
            
            // éªŒè¯å¹´é¾„
            const age = parseInt(formData.age);
            if (isNaN(age) || age < 18 || age > 100) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„ï¼ˆ18-100å²ï¼‰');
                return;
            }

            // éªŒè¯æŠ•èµ„é‡‘é¢
            const amount = parseFloat(formData.annual_investment_amount);
            if (isNaN(amount) || amount <= 0) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ•èµ„é‡‘é¢ï¼ˆå¤§äº0ï¼‰');
                return;
            }

            hideError();
            await submitFormData(formData);
        }

        // æäº¤è¡¨å•æ•°æ®
        async function submitFormData(formData) {
            showView('loading');
            AppState.isLoading = true;
            AppState.errorMessage = '';
            
            try {
                // å¼€å§‹æ¨¡æ‹ŸåŠ è½½æ­¥éª¤
                const loadingPromise = simulateLoadingSteps();
                
                // å‘é€APIè¯·æ±‚
                const response = await fetch('/api/invest/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData),
                    timeout: 60000
                });
                
                // ç­‰å¾…åŠ è½½åŠ¨ç”»å®Œæˆ
                await loadingPromise;
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // æ£€æŸ¥å“åº”ç»“æœ
                if (result.success) {
                    AppState.resultData = result;
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('investmentResult', JSON.stringify(result));
                    localStorage.setItem('lastAssessmentTime', new Date().toISOString());

                    showView('result');
                    renderResultView(result);
                    
                    // è®°å½•æˆåŠŸäº‹ä»¶
                    console.log('æŠ•èµ„æ¨èç”ŸæˆæˆåŠŸ:', {
                        timestamp: result.timestamp,
                        userRiskScore: result.data?.user_profile?.risk_score,
                        expectedReturn: result.data?.the_metrics?.expected_return
                    });
                } else {
                    throw new Error(result.error || 'ç”ŸæˆæŠ•èµ„æ–¹æ¡ˆå¤±è´¥');
                }
                
            } catch (error) {
                console.error('APIè¯·æ±‚é”™è¯¯:', error);
                handleApiError(error);
            } finally {
                AppState.isLoading = false;
            }
        }

        // æ¨¡æ‹ŸåŠ è½½æ­¥éª¤
        async function simulateLoadingSteps() {
            AppState.loadingStep = 0;
            const steps = [
                { element: elements.step1, delay: 800 },
                { element: elements.step2, delay: 1200 },
                { element: elements.step3, delay: 1000 },
                { element: elements.step4, delay: 1500 }
            ];
            
            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, steps[i].delay));
                steps[i].element.classList.add('completed');
                if (i === 3) {
                    steps[i].element.innerHTML = 'âœ“ ç”ŸæˆAIä¸“ä¸šè§£é‡Š';
                }
                AppState.loadingStep = i + 1;
            }
        }

        // å¤„ç†APIé”™è¯¯
        function handleApiError(error) {
            let errorMessage = '';
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                errorMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•';
            } else if (error.message.includes('HTTP error')) {
                const status = parseInt(error.message.match(/\d+/)[0]);
                switch (status) {
                    case 400:
                        errorMessage = 'è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯';
                        break;
                    case 429:
                        errorMessage = 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
                        break;
                    case 500:
                        errorMessage = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                        break;
                    case 503:
                        errorMessage = 'æŠ•èµ„ä¼˜åŒ–æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
                        break;
                    default:
                        errorMessage = `æœåŠ¡å™¨é”™è¯¯ (${status}): è¯·ç¨åé‡è¯•`;
                }
            } else {
                errorMessage = error.message || 'ç³»ç»Ÿå‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·é‡è¯•';
            }
            
            AppState.errorMessage = errorMessage;
            elements.errorViewMessage.textContent = errorMessage;
            showView('error');
        }

        // å¤„ç†é‡è¯•
        function handleRetry() {
            showView('questionnaire');
            AppState.errorMessage = '';
            AppState.loadingStep = 0;
            
            // é‡ç½®åŠ è½½æ­¥éª¤æ˜¾ç¤º
            [elements.step1, elements.step2, elements.step3, elements.step4].forEach((step, index) => {
                step.classList.remove('completed');
                if (index === 3) {
                    step.innerHTML = '<span>â³</span> ç”ŸæˆAIä¸“ä¸šè§£é‡Š';
                }
            });
        }

        function checkResultValidity() {
            const lastAssessmentTime = localStorage.getItem('lastAssessmentTime');
            if (!lastAssessmentTime) return false;
            
            const daysSinceAssessment = (new Date() - new Date(lastAssessmentTime)) / (1000 * 60 * 60 * 24);
            return daysSinceAssessment < 30; // 30å¤©å†…æœ‰æ•ˆ
        }

        // å¤„ç†é‡ç½®
        function handleReset() {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨
            localStorage.removeItem('investmentResult');
            localStorage.removeItem('lastAssessmentTime');

            // é‡ç½®è¡¨å•
            elements.age.value = '';
            elements.annualInvestmentAmount.value = '';
            elements.liquidityDemand.value = '';
            elements.targetReturnDescription.value = '';
            elements.investmentHorizon.value = '';
            
            // é‡ç½®å•é€‰æŒ‰é’®
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // é‡ç½®çŠ¶æ€
            AppState.resultData = null;
            AppState.errorMessage = '';
            AppState.loadingStep = 0;
            
            // æ˜¾ç¤ºé—®å·è§†å›¾
            showView('questionnaire');
            hideError();
            
            // æ¸…é™¤æ»šåŠ¨ä½ç½®
            window.scrollTo(0, 0);
        }

        // æ¸²æŸ“ç»“æœè§†å›¾
        function renderResultView(resultData) {
            const thePlan = resultData.data?.the_plan || {};
            const theMetrics = resultData.data?.the_metrics || {};
            const theExplanation = resultData.data?.the_explanation || {};
            const userProfile = resultData.data?.user_profile || {};
            
            elements.resultView.innerHTML = `
                <!-- è´­ä¹°è®¡åˆ’æ ‡é¢˜å¡ç‰‡ -->
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h1 class="result-title">æ‚¨çš„ä¸“å±æŠ•èµ„è´­ä¹°è®¡åˆ’</h1>
                        <div class="user-profile-summary">
                            <span class="risk-badge ${getRiskLevelClass(userProfile.risk_score)}">
                                ${userProfile.risk_level || 'æ™®é€š'}æŠ•èµ„è€…
                            </span>
                            <span class="profile-item">å¹´é¾„ï¼š${userProfile.age || ''}å²</span>
                            <span class="profile-item">æŠ•èµ„æœŸé™ï¼š${userProfile.investment_horizon || ''}</span>
                            <span class="profile-item">é£é™©è¯„åˆ†ï¼š${userProfile.risk_score || 0}/10</span>
                        </div>
                    </div>
                </div>

                <!-- æŠ•èµ„ç»„åˆå›¾è¡¨å¡ç‰‡ -->
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h2 class="section-title">æŠ•èµ„ç»„åˆé…ç½®</h2>
                        <div class="chart-container">
                            <canvas id="portfolioChart" width="400" height="400"></canvas>
                        </div>
                    </div>
                </div>

                <!-- è´­ä¹°è®¡åˆ’åˆ—è¡¨å¡ç‰‡ (The Plan) -->
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h2 class="section-title">è¯¦ç»†è´­ä¹°è®¡åˆ’</h2>
                        <div class="plan-summary">
                            <span class="summary-item">æ€»æŠ•èµ„é‡‘é¢ï¼š</span>
                            <span class="summary-amount">${formatCurrency(thePlan.total_investment || 0)}</span>
                        </div>
                        <div class="plan-table-container">
                            <table class="plan-table">
                                <thead>
                                    <tr>
                                        <th>åŸºé‡‘åç§°</th>
                                        <th>é…ç½®æƒé‡</th>
                                        <th>æŠ•èµ„é‡‘é¢</th>
                                        <th>é£é™©ç­‰çº§</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${renderPlanTable(thePlan.plan_list || [])}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- é£é™©é‡åŒ–é¢æ¿å¡ç‰‡ (The Metrics) -->
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h2 class="section-title">é£é™©é‡åŒ–æŒ‡æ ‡</h2>
                        <p class="section-subtitle">åŸºäºç°ä»£æŠ•èµ„ç»„åˆç†è®º(MPT)è®¡ç®—çš„é£é™©æŒ‡æ ‡</p>

                        <div class="metrics-grid">
                            <div class="metric-card positive">
                                <div class="metric-icon">ğŸ“ˆ</div>
                                <div class="metric-content">
                                    <div class="metric-title">é¢„æœŸå¹´åŒ–æ”¶ç›Šç‡</div>
                                    <div class="metric-value positive-value">
                                        ${formatPercentage(theMetrics.expected_return || 0)}
                                    </div>
                                    <div class="metric-description">åŸºäºå†å²æ•°æ®é¢„æµ‹çš„å¹´åŒ–æ”¶ç›Šç‡</div>
                                </div>
                            </div>

                            <div class="metric-card warning">
                                <div class="metric-icon">ğŸ“Š</div>
                                <div class="metric-content">
                                    <div class="metric-title">é¢„æœŸå¹´åŒ–æ³¢åŠ¨ç‡</div>
                                    <div class="metric-value danger-value">
                                        ${formatPercentage(theMetrics.expected_volatility || 0)}
                                    </div>
                                    <div class="metric-description">æ”¶ç›Šç‡çš„æ ‡å‡†å·®ï¼Œè¡¡é‡æŠ•èµ„é£é™©</div>
                                </div>
                            </div>

                            <div class="metric-card danger">
                                <div class="metric-icon">âš ï¸</div>
                                <div class="metric-content">
                                    <div class="metric-title">é¢„æœŸæœ€å¤§å›æ’¤</div>
                                    <div class="metric-value danger-value">
                                        ${formatPercentage(theMetrics.max_drawdown_estimate || 0)}
                                    </div>
                                    <div class="metric-description">é¢„ä¼°å¯èƒ½å‡ºç°çš„æœ€å¤§äºæŸå¹…åº¦</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AIä¸“ä¸šè§£é‡Šå¡ç‰‡ (The Explanation) -->
                <div class="questionnaire-card">
                    <div class="card-inner">
                        <h2 class="section-title">AIä¸“ä¸šæŠ•èµ„è§£é‡Š</h2>
                        <p class="section-subtitle">ç”±AIå¤§æ¨¡å‹åŸºäºMPTç†è®ºç”Ÿæˆçš„ä¸“ä¸šåˆ†æ</p>

                        <div class="explanation-content">
                            <div class="explanation-text">${formatExplanationText(theExplanation.qwen_explanation_text || '')}</div>
                        </div>
                    </div>
                </div>

                <!-- é‡è¦å…è´£å£°æ˜å¡ç‰‡ -->
                <div class="disclaimer-card">
                    <div class="disclaimer-content">
                        <div class="disclaimer-icon">âš ï¸</div>
                        <h3 class="disclaimer-title">é‡è¦å…è´£å£°æ˜</h3>
                        <div class="disclaimer-text">${formatExplanationText(theExplanation.disclaimer || '')}</div>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
                <div class="action-buttons">
                    <button id="resetFromResult" class="btn btn-outline">é‡æ–°è¯„ä¼°</button>
                    <button id="viewProducts" class="btn btn-secondary">æŸ¥çœ‹æ¨èäº§å“</button>
                    <button id="exportButton" class="btn btn-primary">å¯¼å‡ºæŠ¥å‘Š</button>
                </div>
            `;
            
            // æ·»åŠ ç»“æœé¡µé¢çš„æŒ‰é’®äº‹ä»¶
            document.getElementById('resetFromResult').addEventListener('click', handleReset);
            document.getElementById('viewProducts').addEventListener('click', () => showView('products'));
            document.getElementById('exportButton').addEventListener('click', () => handleExport(resultData));
            
            // åˆ›å»ºå›¾è¡¨
            createPortfolioChart(thePlan.plan_list || []);
        }

        // æ¸²æŸ“è®¡åˆ’è¡¨æ ¼
        function renderPlanTable(planList) {
            if (!planList.length) {
                return '<tr><td colspan="4" style="text-align: center;">æš‚æ— æ•°æ®</td></tr>';
            }
            
            return planList.map((item, index) => `
                <tr>
                    <td class="fund-name">
                        <div class="fund-info">
                            <span class="fund-rank">${index + 1}</span>
                            ${item.fund_name || ''}
                        </div>
                    </td>
                    <td class="weight-cell">
                        <div class="weight-display">
                            <div class="weight-bar">
                                <div
                                    class="weight-fill"
                                    style="width: ${item.weight_percentage || 0}%"
                                ></div>
                                <span class="weight-text">${(item.weight_percentage || 0).toFixed(1)}%</span>
                            </div>
                        </div>
                    </td>
                    <td class="amount-cell">
                        <span class="amount-text">${formatCurrency(item.investment_amount || 0)}</span>
                    </td>
                    <td class="risk-cell">
                        <span class="risk-level-badge ${getFundRiskLevelClass(item)}">
                            ${getFundRiskLevel(item)}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // åˆ›å»ºæŠ•èµ„ç»„åˆå›¾è¡¨
        function createPortfolioChart(planList) {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            
            if (!planList.length) {
                // æ˜¾ç¤ºæ— æ•°æ®æ¶ˆæ¯
                ctx.font = '16px Arial';
                ctx.fillStyle = '#7F8C8D';
                ctx.textAlign = 'center';
                ctx.fillText('æš‚æ— æ•°æ®', 200, 200);
                return;
            }
            
            const chartData = {
                labels: planList.map(item => item.fund_name),
                datasets: [{
                    data: planList.map(item => item.weight_percentage),
                    backgroundColor: [
                        '#10B981', '#059669', '#34D399', '#10B981',
                        '#F59E0B', '#FBBF24', '#EF4444', '#F87171',
                        '#60A5FA', '#3B82F6'
                    ],
                    borderWidth: 2,
                    borderColor: '#FFFFFF'
                }]
            };
            
            new Chart(ctx, {
                type: 'doughnut',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const percentage = value.toFixed(1);
                                    return `${label}: ${percentage}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // å¤„ç†å¯¼å‡º
        function handleExport(data) {
            try {
                // åˆ›å»ºå¯¼å‡ºæ•°æ®
                const exportData = {
                    title: 'æ™ºèƒ½é‡‘èåŠ©æ‰‹ - æŠ•èµ„ç»„åˆæŠ¥å‘Š',
                    timestamp: new Date().toLocaleString('zh-CN'),
                    user_profile: data.data?.user_profile || {},
                    the_plan: data.data?.the_plan || {},
                    the_metrics: data.data?.the_metrics || {},
                    the_explanation: data.data?.the_explanation || {}
                };

                // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
                const jsonString = JSON.stringify(exportData, null, 2);

                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([jsonString], { type: 'application/json' });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `æŠ•èµ„ç»„åˆæŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.json`;

                // è§¦å‘ä¸‹è½½
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // æ¸…ç†URLå¯¹è±¡
                URL.revokeObjectURL(url);

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                alert('æŠ•èµ„ç»„åˆæŠ¥å‘Šå·²å¯¼å‡º');

            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // å·¥å…·å‡½æ•°
        function getRiskLevelClass(riskScore) {
            if (riskScore <= 3) return 'risk-conservative';
            if (riskScore <= 7) return 'risk-moderate';
            return 'risk-aggressive';
        }

        function getFundRiskLevel(fund) {
            const fundName = fund.fund_name || '';
            if (fundName.includes('è´§å¸') || fundName.includes('å€ºåˆ¸') || fundName.includes('ç¨³å¥')) {
                return 'ä½é£é™©';
            } else if (fundName.includes('æ··åˆ') || fundName.includes('æŒ‡æ•°') || fundName.includes('QDII')) {
                return 'ä¸­ç­‰é£é™©';
            } else if (fundName.includes('è‚¡ç¥¨') || fundName.includes('æˆé•¿') || fundName.includes('REITs') || fundName.includes('å•†å“')) {
                return 'é«˜é£é™©';
            }
            return 'ä¸­ç­‰é£é™©';
        }

        function getFundRiskLevelClass(fund) {
            const riskLevel = getFundRiskLevel(fund);
            switch (riskLevel) {
                case 'ä½é£é™©':
                    return 'risk-low';
                case 'ä¸­ç­‰é£é™©':
                    return 'risk-medium';
                case 'é«˜é£é™©':
                    return 'risk-high';
                default:
                    return 'risk-medium';
            }
        }

        function formatPercentage(value) {
            if (typeof value !== 'number') return '0.00%';
            return (value * 100).toFixed(2) + '%';
        }

        function formatCurrency(amount) {
            if (typeof amount !== 'number') return 'Â¥0.00';
            return 'Â¥' + amount.toLocaleString('zh-CN', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatExplanationText(text) {
            return text.replace(/\n/g, '<br>');
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>